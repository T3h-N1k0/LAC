{% from "_formhelpers.html" import render_formfield, render_field %}
{% extends "layout.html" %}

{% block title %} Recherche de compte {% endblock title %}

{% block head_js %}

<link rel="stylesheet" href="{{
      url_for('static', filename='themes/blue/style.css')
      }}" type="text/css" id="" media="print, projection, screen" />

<script type="text/javascript" src="{{
         url_for('static', filename='jquery-2.1.1.js')
         }}"></script>

<script type="text/javascript" src="{{
         url_for('static', filename='jquery.tablesorter.min.js')
         }}"></script>

<script type="text/javascript" src="{{
        url_for('static', filename='excellentexport.min.js')
        }}"></script>


<script type="text/javascript" id="js">
 $(document).ready(function() {
   $("#userz").tablesorter({widthFixed: true, widgets: ['zebra']});
 }
 );

</script>


{% endblock head_js %}

{% block body %}
<form method=post action="/search_user">
  <dl>
    {{ render_formfield(form.uid_number) }}
    {{ render_formfield(form.sn) }}
    {{ render_formfield(form.uid) }}
    {{ render_formfield(form.mail) }}
    {{ render_formfield(form.user_type) }}
    {{ render_formfield(form.user_disabled) }}
  </dl>
  <p><input type=submit value=Chercher>
</form>

{% if userz %}
<h1>Liste des utilisateurs : </h1>
<a download="user_list_{{ timestamp }}.xls" href="#" onclick="return ExcellentExport.excel(this, 'userz', 'Comptes');">Exporter vers Excel</a>
<a download="user_list_{{ timestamp }}.csv" href="#" onclick="return ExcellentExport.csv(this, 'userz');">Export vers CSV</a>

<table  class="tablesorter" id="userz"  >
  <thead>
  <tr>
    {% for attribute in attributes %}
    <th>{{ attribute.description }}</th>
    {% endfor %}
  </tr>
  </thead>
  <tbody>
  {% for user in userz|sort %}
      <tr onclick="document.location = '{{ url_for('show',
           page=get_group_from_member_uid(user.get_attributes()['uid'][0]),
           uid=user.get_attributes()['uid'][0] ) }}'">
        {% for attr in attributes %}
        <td>
          {% for value in user.get_attributes()[attr.label]  %}
          {{ render_field(value.decode('utf-8'), attr.fieldtype.type) }}
          {% endfor %}
        </td>
        {% endfor %}
      </tr>
      {% endfor %}
  </tbody>
</table>
{% else %}
<h1>Aucun r√©sultat</h1>
{% endif %}


{{ search_resultz  }}
{% endblock %}
